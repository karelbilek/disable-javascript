'use strict';var browser=browser,promises=!0;function domContentLoaded(){var i=[{label:'Default state',name:'default_state',type:'radio',options:[{label:'JS on',value:'on'},{label:'JS off',value:'off'}]},{label:'Enable shortcuts',details:'(<a href="about.html#shortcuts">More information</a>)',name:'shortcuts',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]},{label:'Enable context menu item',name:'context_menu',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]}],m='setting-',a=document.getElementById('add-domain-form-modal'),o=document.getElementById('add-domain-form'),n=document.getElementById('add-domain-form__domain-name'),e=document.getElementById('add-domain-form-modal__close'),s=document.getElementById('add-domain-form__include-sub-domains'),u=document.getElementById('remove'),v=document.getElementById('remove-all'),t=document.getElementById('add-domain'),b=document.getElementById('edit-domain'),l=document.getElementById('add-domain__previous_host'),d=document.getElementById('add-domain__title'),r=document.getElementById('add-domain__submit'),c=' <span class="version">(v'+browser.runtime.getManifest().version+')</span>';function g(e){var a=document.getElementById('domain-list--tbody'),t='',o=!1,n=[],s=document.getElementById('search');for(d in e)d.startsWith(m)||(n.push(d),o=!0);for(var l=n.length-1;0<=l;l--){var d,r,i=!1;'string'==typeof e[d=n[l]]?r=new Date(e[d]):(r=new Date(e[d].date),i=e[d]['include-subdomains']),t+='<tr data-host="'+d+'" data-include-subdomains="'+(i?'true':'false')+'">',t+='<td>'+d+'</td>',t+='<td>'+r.toLocaleDateString()+' '+r.toLocaleTimeString()+'</td>',t+='<td>'+(i?'Yes':'No')+'</td>',t+='</tr>'}0===t.length?(t+='<tr>',t+='<td class="empty" colspan="3">You have not added any domains to your allow-/blocklist yet.</td>',t+='</tr>',s.disabled=!0):s.disabled=!1,a.innerHTML=t;for(var c=a.querySelectorAll('tr'),l=0;l<c.length;l++)c[l].addEventListener('click',function(){if(this.classList.contains('active'))this.classList.remove('active'),u.disabled=!0,b.disabled=!0;else{for(var e=a.querySelectorAll('tr.active'),t=0;t<e.length;t++)e[t].classList.remove('active');this.classList.add('active'),u.disabled=!1,b.disabled=!1}});o&&(v.disabled=!1)}function h(e){'domain'===e[m+'disable_behavior']?(document.body.classList.remove('disable-behavior--tab'),promises?browser.storage.local.get().then(g):browser.storage.local.get(g)):document.body.classList.add('disable-behavior--tab')}function f(){u.disabled=!0,v.disabled=!0,b.disabled=!0,promises?browser.storage.local.get(m+'disable_behavior').then(h):browser.storage.local.get(m+'disable_behavior',h)}function y(){var e,t=document.getElementsByClassName('active');o.reset(),'add-domain'===this.id?(l.value='',d.innerHTML='Add a new host',r.value='Add host'):(e=(t=t[0]).getAttribute('data-host'),t=t.getAttribute('data-include-subdomains'),d.innerHTML='Edit host <em>'+e+'</em>',n.value=e,s.checked='true'===t,l.value=e,r.value='Edit host'),a.style.display='block',n.focus()}function p(){a.style.display='none'}function E(){var e={},t=this.value;switch(this.value){case'true':t=!0;break;case'false':t=!1}e[m+this.name]=t,browser.storage.local.set(e),browser.runtime.sendMessage({type:this.name,value:t}),f()}function w(e){for(var t='',a=0;a<i.length;a++){var o=i[a];t+='<tr>',t+='<td><label>'+o.label+'</label><span>','details'in o&&(t+=o.details),t+='</span></td><td>';for(var n=0;n<i[a].options.length;n++){var s=o.options[n],l=o.name+'-'+s.value,d='';(e[m+o.name]===s.value||!0===e[m+o.name]&&'true'===s.value||!1===e[m+o.name]&&'false'===s.value)&&(d=' checked="checked"'),t+='<input type="'+o.type+'" name="'+o.name+'" id="'+l+'" value="'+s.value+'"'+d+' />',t+='<label for="'+l+'">'+s.label+'</label>'}t+='</td>',t+='</tr>'}document.getElementById('settings').innerHTML=t;for(var r=document.querySelectorAll('input[type=radio]'),a=0;a<r.length;a++)r[a].addEventListener('click',E)}for(var L=document.querySelectorAll('input[type=button]'),B=0;B<L.length;B++)switch(L[B].id){case'remove':case'remove-all':case'edit':L[B].disabled=!0}!function(){for(var e=[],t=0;t<i.length;t++)e.push(m+i[t].name);promises?browser.storage.local.get(e).then(w):browser.storage.local.get(e,w)}(),f(),u.addEventListener('click',function(){for(var e=document.querySelectorAll('#domain-list--tbody tr.active'),t=0;t<e.length;t++){var a=e[t].childNodes[0].innerHTML;promises?browser.storage.local.remove(a).then(f):browser.storage.local.remove(a,f)}}),v.addEventListener('click',function(){if(confirm('Are you sure to clear your domain list?')){for(var e={},t=0;t<i.length;t++){var a=i[t].name,o=document.querySelector('input[name="'+a+'"]:checked').value;e[m+a]=o}var n=browser.runtime.getManifest();e['setting-version']=n.version,promises?browser.storage.local.clear().then(function(){browser.storage.local.set(e).then(function(){f()})}):browser.storage.local.clear(function(){browser.storage.local.set(e,function(){f()})})}}),t.addEventListener('click',y),b.addEventListener('click',y),o.addEventListener('submit',function(e){e.preventDefault();var t=n.value;return/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/.test(t)?(l.value.length&&browser.storage.local.remove(l.value),(e={})[t]={date:(new Date).toISOString()},s.checked&&(e[t]['include-subdomains']=!0),promises?browser.storage.local.set(e).then(function(){f(),p()}):browser.storage.local.set(e,function(){f(),p()})):n.setCustomValidity('Please enter a valid host'),!1}),n.addEventListener('change',function(){this.setCustomValidity('')}),e.addEventListener('click',p),document.getElementById('search').value='',document.getElementById('search').addEventListener('keyup',function(){for(var e=document.getElementById('domain-list--tbody').getElementsByTagName('tr'),t=0;t<e.length;t++){var a=e[t].getElementsByTagName('td')[0];a&&(-1<a.innerHTML.toUpperCase().indexOf(this.value.toUpperCase())?e[t].style.display='':e[t].style.display='none')}}),window.addEventListener('click',function(e){void 0!==e&&e.target===a&&p()}),document.getElementById('page-title').innerHTML+=c}void 0===browser&&(browser=chrome,promises=!1),document.addEventListener('DOMContentLoaded',domContentLoaded);